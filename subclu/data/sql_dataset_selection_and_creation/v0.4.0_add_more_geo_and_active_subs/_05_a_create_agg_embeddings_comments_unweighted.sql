-- NOTE: this query runs out of memory in BigQuery
-- Here we tried with regular AVG (unweighted) to reduce memory load
--  However, this still runs out of memory - even when trying to batch only 10 subreddts
DECLARE subreddit_rank_min NUMERIC DEFAULT 1;
DECLARE subreddit_rank_max NUMERIC DEFAULT 10;

CREATE OR REPLACE TABLE `reddit-employee-datasets.david_bermejo.subclu_v0040_embeddings_agg_comments_to_post_level_weight_by_upvotes_0`
AS (
    WITH
    selected_subreddits AS (
        SELECT subreddit_id
        FROM (
            SELECT
                subreddit_id
                , ROW_NUMBER() OVER (PARTITION BY subreddit_id) AS row_subreddit_id
            FROM `reddit-employee-datasets.david_bermejo.subclu_subreddits_top_no_geo_20210924`
        )
        WHERE 1=1
            AND subreddit_rank_min <= row_subreddit_id
            AND row_subreddit_id < subreddit_rank_max
    )

    SELECT
        cem.subreddit_id
        , cem.post_id
        -- these cols can be good for debugging/testing, but not needed in final table
        -- , COUNT(cem.comment_id)  AS comment_id_count
        -- , SUM(ln_upvotes) AS ln_upvotes_sum

        , AVG(embeddings_0) AS embeddings_0
        , AVG(embeddings_1) AS embeddings_1
        , AVG(embeddings_2) AS embeddings_2
        , AVG(embeddings_3) AS embeddings_3
        , AVG(embeddings_4) AS embeddings_4
        , AVG(embeddings_5) AS embeddings_5
        , AVG(embeddings_6) AS embeddings_6
        , AVG(embeddings_7) AS embeddings_7
        , AVG(embeddings_8) AS embeddings_8
        , AVG(embeddings_9) AS embeddings_9
        , AVG(embeddings_10) AS embeddings_10
        , AVG(embeddings_11) AS embeddings_11
        , AVG(embeddings_12) AS embeddings_12
        , AVG(embeddings_13) AS embeddings_13
        , AVG(embeddings_14) AS embeddings_14
        , AVG(embeddings_15) AS embeddings_15
        , AVG(embeddings_16) AS embeddings_16
        , AVG(embeddings_17) AS embeddings_17
        , AVG(embeddings_18) AS embeddings_18
        , AVG(embeddings_19) AS embeddings_19
        , AVG(embeddings_20) AS embeddings_20
        , AVG(embeddings_21) AS embeddings_21
        , AVG(embeddings_22) AS embeddings_22
        , AVG(embeddings_23) AS embeddings_23
        , AVG(embeddings_24) AS embeddings_24
        , AVG(embeddings_25) AS embeddings_25
        , AVG(embeddings_26) AS embeddings_26
        , AVG(embeddings_27) AS embeddings_27
        , AVG(embeddings_28) AS embeddings_28
        , AVG(embeddings_29) AS embeddings_29
        , AVG(embeddings_30) AS embeddings_30
        , AVG(embeddings_31) AS embeddings_31
        , AVG(embeddings_32) AS embeddings_32
        , AVG(embeddings_33) AS embeddings_33
        , AVG(embeddings_34) AS embeddings_34
        , AVG(embeddings_35) AS embeddings_35
        , AVG(embeddings_36) AS embeddings_36
        , AVG(embeddings_37) AS embeddings_37
        , AVG(embeddings_38) AS embeddings_38
        , AVG(embeddings_39) AS embeddings_39
        , AVG(embeddings_40) AS embeddings_40
        , AVG(embeddings_41) AS embeddings_41
        , AVG(embeddings_42) AS embeddings_42
        , AVG(embeddings_43) AS embeddings_43
        , AVG(embeddings_44) AS embeddings_44
        , AVG(embeddings_45) AS embeddings_45
        , AVG(embeddings_46) AS embeddings_46
        , AVG(embeddings_47) AS embeddings_47
        , AVG(embeddings_48) AS embeddings_48
        , AVG(embeddings_49) AS embeddings_49
        , AVG(embeddings_50) AS embeddings_50
        , AVG(embeddings_51) AS embeddings_51
        , AVG(embeddings_52) AS embeddings_52
        , AVG(embeddings_53) AS embeddings_53
        , AVG(embeddings_54) AS embeddings_54
        , AVG(embeddings_55) AS embeddings_55
        , AVG(embeddings_56) AS embeddings_56
        , AVG(embeddings_57) AS embeddings_57
        , AVG(embeddings_58) AS embeddings_58
        , AVG(embeddings_59) AS embeddings_59
        , AVG(embeddings_60) AS embeddings_60
        , AVG(embeddings_61) AS embeddings_61
        , AVG(embeddings_62) AS embeddings_62
        , AVG(embeddings_63) AS embeddings_63
        , AVG(embeddings_64) AS embeddings_64
        , AVG(embeddings_65) AS embeddings_65
        , AVG(embeddings_66) AS embeddings_66
        , AVG(embeddings_67) AS embeddings_67
        , AVG(embeddings_68) AS embeddings_68
        , AVG(embeddings_69) AS embeddings_69
        , AVG(embeddings_70) AS embeddings_70
        , AVG(embeddings_71) AS embeddings_71
        , AVG(embeddings_72) AS embeddings_72
        , AVG(embeddings_73) AS embeddings_73
        , AVG(embeddings_74) AS embeddings_74
        , AVG(embeddings_75) AS embeddings_75
        , AVG(embeddings_76) AS embeddings_76
        , AVG(embeddings_77) AS embeddings_77
        , AVG(embeddings_78) AS embeddings_78
        , AVG(embeddings_79) AS embeddings_79
        , AVG(embeddings_80) AS embeddings_80
        , AVG(embeddings_81) AS embeddings_81
        , AVG(embeddings_82) AS embeddings_82
        , AVG(embeddings_83) AS embeddings_83
        , AVG(embeddings_84) AS embeddings_84
        , AVG(embeddings_85) AS embeddings_85
        , AVG(embeddings_86) AS embeddings_86
        , AVG(embeddings_87) AS embeddings_87
        , AVG(embeddings_88) AS embeddings_88
        , AVG(embeddings_89) AS embeddings_89
        , AVG(embeddings_90) AS embeddings_90
        , AVG(embeddings_91) AS embeddings_91
        , AVG(embeddings_92) AS embeddings_92
        , AVG(embeddings_93) AS embeddings_93
        , AVG(embeddings_94) AS embeddings_94
        , AVG(embeddings_95) AS embeddings_95
        , AVG(embeddings_96) AS embeddings_96
        , AVG(embeddings_97) AS embeddings_97
        , AVG(embeddings_98) AS embeddings_98
        , AVG(embeddings_99) AS embeddings_99
        , AVG(embeddings_100) AS embeddings_100
        , AVG(embeddings_101) AS embeddings_101
        , AVG(embeddings_102) AS embeddings_102
        , AVG(embeddings_103) AS embeddings_103
        , AVG(embeddings_104) AS embeddings_104
        , AVG(embeddings_105) AS embeddings_105
        , AVG(embeddings_106) AS embeddings_106
        , AVG(embeddings_107) AS embeddings_107
        , AVG(embeddings_108) AS embeddings_108
        , AVG(embeddings_109) AS embeddings_109
        , AVG(embeddings_110) AS embeddings_110
        , AVG(embeddings_111) AS embeddings_111
        , AVG(embeddings_112) AS embeddings_112
        , AVG(embeddings_113) AS embeddings_113
        , AVG(embeddings_114) AS embeddings_114
        , AVG(embeddings_115) AS embeddings_115
        , AVG(embeddings_116) AS embeddings_116
        , AVG(embeddings_117) AS embeddings_117
        , AVG(embeddings_118) AS embeddings_118
        , AVG(embeddings_119) AS embeddings_119
        , AVG(embeddings_120) AS embeddings_120
        , AVG(embeddings_121) AS embeddings_121
        , AVG(embeddings_122) AS embeddings_122
        , AVG(embeddings_123) AS embeddings_123
        , AVG(embeddings_124) AS embeddings_124
        , AVG(embeddings_125) AS embeddings_125
        , AVG(embeddings_126) AS embeddings_126
        , AVG(embeddings_127) AS embeddings_127
        , AVG(embeddings_128) AS embeddings_128
        , AVG(embeddings_129) AS embeddings_129
        , AVG(embeddings_130) AS embeddings_130
        , AVG(embeddings_131) AS embeddings_131
        , AVG(embeddings_132) AS embeddings_132
        , AVG(embeddings_133) AS embeddings_133
        , AVG(embeddings_134) AS embeddings_134
        , AVG(embeddings_135) AS embeddings_135
        , AVG(embeddings_136) AS embeddings_136
        , AVG(embeddings_137) AS embeddings_137
        , AVG(embeddings_138) AS embeddings_138
        , AVG(embeddings_139) AS embeddings_139
        , AVG(embeddings_140) AS embeddings_140
        , AVG(embeddings_141) AS embeddings_141
        , AVG(embeddings_142) AS embeddings_142
        , AVG(embeddings_143) AS embeddings_143
        , AVG(embeddings_144) AS embeddings_144
        , AVG(embeddings_145) AS embeddings_145
        , AVG(embeddings_146) AS embeddings_146
        , AVG(embeddings_147) AS embeddings_147
        , AVG(embeddings_148) AS embeddings_148
        , AVG(embeddings_149) AS embeddings_149
        , AVG(embeddings_150) AS embeddings_150
        , AVG(embeddings_151) AS embeddings_151
        , AVG(embeddings_152) AS embeddings_152
        , AVG(embeddings_153) AS embeddings_153
        , AVG(embeddings_154) AS embeddings_154
        , AVG(embeddings_155) AS embeddings_155
        , AVG(embeddings_156) AS embeddings_156
        , AVG(embeddings_157) AS embeddings_157
        , AVG(embeddings_158) AS embeddings_158
        , AVG(embeddings_159) AS embeddings_159
        , AVG(embeddings_160) AS embeddings_160
        , AVG(embeddings_161) AS embeddings_161
        , AVG(embeddings_162) AS embeddings_162
        , AVG(embeddings_163) AS embeddings_163
        , AVG(embeddings_164) AS embeddings_164
        , AVG(embeddings_165) AS embeddings_165
        , AVG(embeddings_166) AS embeddings_166
        , AVG(embeddings_167) AS embeddings_167
        , AVG(embeddings_168) AS embeddings_168
        , AVG(embeddings_169) AS embeddings_169
        , AVG(embeddings_170) AS embeddings_170
        , AVG(embeddings_171) AS embeddings_171
        , AVG(embeddings_172) AS embeddings_172
        , AVG(embeddings_173) AS embeddings_173
        , AVG(embeddings_174) AS embeddings_174
        , AVG(embeddings_175) AS embeddings_175
        , AVG(embeddings_176) AS embeddings_176
        , AVG(embeddings_177) AS embeddings_177
        , AVG(embeddings_178) AS embeddings_178
        , AVG(embeddings_179) AS embeddings_179
        , AVG(embeddings_180) AS embeddings_180
        , AVG(embeddings_181) AS embeddings_181
        , AVG(embeddings_182) AS embeddings_182
        , AVG(embeddings_183) AS embeddings_183
        , AVG(embeddings_184) AS embeddings_184
        , AVG(embeddings_185) AS embeddings_185
        , AVG(embeddings_186) AS embeddings_186
        , AVG(embeddings_187) AS embeddings_187
        , AVG(embeddings_188) AS embeddings_188
        , AVG(embeddings_189) AS embeddings_189
        , AVG(embeddings_190) AS embeddings_190
        , AVG(embeddings_191) AS embeddings_191
        , AVG(embeddings_192) AS embeddings_192
        , AVG(embeddings_193) AS embeddings_193
        , AVG(embeddings_194) AS embeddings_194
        , AVG(embeddings_195) AS embeddings_195
        , AVG(embeddings_196) AS embeddings_196
        , AVG(embeddings_197) AS embeddings_197
        , AVG(embeddings_198) AS embeddings_198
        , AVG(embeddings_199) AS embeddings_199
        , AVG(embeddings_200) AS embeddings_200
        , AVG(embeddings_201) AS embeddings_201
        , AVG(embeddings_202) AS embeddings_202
        , AVG(embeddings_203) AS embeddings_203
        , AVG(embeddings_204) AS embeddings_204
        , AVG(embeddings_205) AS embeddings_205
        , AVG(embeddings_206) AS embeddings_206
        , AVG(embeddings_207) AS embeddings_207
        , AVG(embeddings_208) AS embeddings_208
        , AVG(embeddings_209) AS embeddings_209
        , AVG(embeddings_210) AS embeddings_210
        , AVG(embeddings_211) AS embeddings_211
        , AVG(embeddings_212) AS embeddings_212
        , AVG(embeddings_213) AS embeddings_213
        , AVG(embeddings_214) AS embeddings_214
        , AVG(embeddings_215) AS embeddings_215
        , AVG(embeddings_216) AS embeddings_216
        , AVG(embeddings_217) AS embeddings_217
        , AVG(embeddings_218) AS embeddings_218
        , AVG(embeddings_219) AS embeddings_219
        , AVG(embeddings_220) AS embeddings_220
        , AVG(embeddings_221) AS embeddings_221
        , AVG(embeddings_222) AS embeddings_222
        , AVG(embeddings_223) AS embeddings_223
        , AVG(embeddings_224) AS embeddings_224
        , AVG(embeddings_225) AS embeddings_225
        , AVG(embeddings_226) AS embeddings_226
        , AVG(embeddings_227) AS embeddings_227
        , AVG(embeddings_228) AS embeddings_228
        , AVG(embeddings_229) AS embeddings_229
        , AVG(embeddings_230) AS embeddings_230
        , AVG(embeddings_231) AS embeddings_231
        , AVG(embeddings_232) AS embeddings_232
        , AVG(embeddings_233) AS embeddings_233
        , AVG(embeddings_234) AS embeddings_234
        , AVG(embeddings_235) AS embeddings_235
        , AVG(embeddings_236) AS embeddings_236
        , AVG(embeddings_237) AS embeddings_237
        , AVG(embeddings_238) AS embeddings_238
        , AVG(embeddings_239) AS embeddings_239
        , AVG(embeddings_240) AS embeddings_240
        , AVG(embeddings_241) AS embeddings_241
        , AVG(embeddings_242) AS embeddings_242
        , AVG(embeddings_243) AS embeddings_243
        , AVG(embeddings_244) AS embeddings_244
        , AVG(embeddings_245) AS embeddings_245
        , AVG(embeddings_246) AS embeddings_246
        , AVG(embeddings_247) AS embeddings_247
        , AVG(embeddings_248) AS embeddings_248
        , AVG(embeddings_249) AS embeddings_249
        , AVG(embeddings_250) AS embeddings_250
        , AVG(embeddings_251) AS embeddings_251
        , AVG(embeddings_252) AS embeddings_252
        , AVG(embeddings_253) AS embeddings_253
        , AVG(embeddings_254) AS embeddings_254
        , AVG(embeddings_255) AS embeddings_255
        , AVG(embeddings_256) AS embeddings_256
        , AVG(embeddings_257) AS embeddings_257
        , AVG(embeddings_258) AS embeddings_258
        , AVG(embeddings_259) AS embeddings_259
        , AVG(embeddings_260) AS embeddings_260
        , AVG(embeddings_261) AS embeddings_261
        , AVG(embeddings_262) AS embeddings_262
        , AVG(embeddings_263) AS embeddings_263
        , AVG(embeddings_264) AS embeddings_264
        , AVG(embeddings_265) AS embeddings_265
        , AVG(embeddings_266) AS embeddings_266
        , AVG(embeddings_267) AS embeddings_267
        , AVG(embeddings_268) AS embeddings_268
        , AVG(embeddings_269) AS embeddings_269
        , AVG(embeddings_270) AS embeddings_270
        , AVG(embeddings_271) AS embeddings_271
        , AVG(embeddings_272) AS embeddings_272
        , AVG(embeddings_273) AS embeddings_273
        , AVG(embeddings_274) AS embeddings_274
        , AVG(embeddings_275) AS embeddings_275
        , AVG(embeddings_276) AS embeddings_276
        , AVG(embeddings_277) AS embeddings_277
        , AVG(embeddings_278) AS embeddings_278
        , AVG(embeddings_279) AS embeddings_279
        , AVG(embeddings_280) AS embeddings_280
        , AVG(embeddings_281) AS embeddings_281
        , AVG(embeddings_282) AS embeddings_282
        , AVG(embeddings_283) AS embeddings_283
        , AVG(embeddings_284) AS embeddings_284
        , AVG(embeddings_285) AS embeddings_285
        , AVG(embeddings_286) AS embeddings_286
        , AVG(embeddings_287) AS embeddings_287
        , AVG(embeddings_288) AS embeddings_288
        , AVG(embeddings_289) AS embeddings_289
        , AVG(embeddings_290) AS embeddings_290
        , AVG(embeddings_291) AS embeddings_291
        , AVG(embeddings_292) AS embeddings_292
        , AVG(embeddings_293) AS embeddings_293
        , AVG(embeddings_294) AS embeddings_294
        , AVG(embeddings_295) AS embeddings_295
        , AVG(embeddings_296) AS embeddings_296
        , AVG(embeddings_297) AS embeddings_297
        , AVG(embeddings_298) AS embeddings_298
        , AVG(embeddings_299) AS embeddings_299
        , AVG(embeddings_300) AS embeddings_300
        , AVG(embeddings_301) AS embeddings_301
        , AVG(embeddings_302) AS embeddings_302
        , AVG(embeddings_303) AS embeddings_303
        , AVG(embeddings_304) AS embeddings_304
        , AVG(embeddings_305) AS embeddings_305
        , AVG(embeddings_306) AS embeddings_306
        , AVG(embeddings_307) AS embeddings_307
        , AVG(embeddings_308) AS embeddings_308
        , AVG(embeddings_309) AS embeddings_309
        , AVG(embeddings_310) AS embeddings_310
        , AVG(embeddings_311) AS embeddings_311
        , AVG(embeddings_312) AS embeddings_312
        , AVG(embeddings_313) AS embeddings_313
        , AVG(embeddings_314) AS embeddings_314
        , AVG(embeddings_315) AS embeddings_315
        , AVG(embeddings_316) AS embeddings_316
        , AVG(embeddings_317) AS embeddings_317
        , AVG(embeddings_318) AS embeddings_318
        , AVG(embeddings_319) AS embeddings_319
        , AVG(embeddings_320) AS embeddings_320
        , AVG(embeddings_321) AS embeddings_321
        , AVG(embeddings_322) AS embeddings_322
        , AVG(embeddings_323) AS embeddings_323
        , AVG(embeddings_324) AS embeddings_324
        , AVG(embeddings_325) AS embeddings_325
        , AVG(embeddings_326) AS embeddings_326
        , AVG(embeddings_327) AS embeddings_327
        , AVG(embeddings_328) AS embeddings_328
        , AVG(embeddings_329) AS embeddings_329
        , AVG(embeddings_330) AS embeddings_330
        , AVG(embeddings_331) AS embeddings_331
        , AVG(embeddings_332) AS embeddings_332
        , AVG(embeddings_333) AS embeddings_333
        , AVG(embeddings_334) AS embeddings_334
        , AVG(embeddings_335) AS embeddings_335
        , AVG(embeddings_336) AS embeddings_336
        , AVG(embeddings_337) AS embeddings_337
        , AVG(embeddings_338) AS embeddings_338
        , AVG(embeddings_339) AS embeddings_339
        , AVG(embeddings_340) AS embeddings_340
        , AVG(embeddings_341) AS embeddings_341
        , AVG(embeddings_342) AS embeddings_342
        , AVG(embeddings_343) AS embeddings_343
        , AVG(embeddings_344) AS embeddings_344
        , AVG(embeddings_345) AS embeddings_345
        , AVG(embeddings_346) AS embeddings_346
        , AVG(embeddings_347) AS embeddings_347
        , AVG(embeddings_348) AS embeddings_348
        , AVG(embeddings_349) AS embeddings_349
        , AVG(embeddings_350) AS embeddings_350
        , AVG(embeddings_351) AS embeddings_351
        , AVG(embeddings_352) AS embeddings_352
        , AVG(embeddings_353) AS embeddings_353
        , AVG(embeddings_354) AS embeddings_354
        , AVG(embeddings_355) AS embeddings_355
        , AVG(embeddings_356) AS embeddings_356
        , AVG(embeddings_357) AS embeddings_357
        , AVG(embeddings_358) AS embeddings_358
        , AVG(embeddings_359) AS embeddings_359
        , AVG(embeddings_360) AS embeddings_360
        , AVG(embeddings_361) AS embeddings_361
        , AVG(embeddings_362) AS embeddings_362
        , AVG(embeddings_363) AS embeddings_363
        , AVG(embeddings_364) AS embeddings_364
        , AVG(embeddings_365) AS embeddings_365
        , AVG(embeddings_366) AS embeddings_366
        , AVG(embeddings_367) AS embeddings_367
        , AVG(embeddings_368) AS embeddings_368
        , AVG(embeddings_369) AS embeddings_369
        , AVG(embeddings_370) AS embeddings_370
        , AVG(embeddings_371) AS embeddings_371
        , AVG(embeddings_372) AS embeddings_372
        , AVG(embeddings_373) AS embeddings_373
        , AVG(embeddings_374) AS embeddings_374
        , AVG(embeddings_375) AS embeddings_375
        , AVG(embeddings_376) AS embeddings_376
        , AVG(embeddings_377) AS embeddings_377
        , AVG(embeddings_378) AS embeddings_378
        , AVG(embeddings_379) AS embeddings_379
        , AVG(embeddings_380) AS embeddings_380
        , AVG(embeddings_381) AS embeddings_381
        , AVG(embeddings_382) AS embeddings_382
        , AVG(embeddings_383) AS embeddings_383
        , AVG(embeddings_384) AS embeddings_384
        , AVG(embeddings_385) AS embeddings_385
        , AVG(embeddings_386) AS embeddings_386
        , AVG(embeddings_387) AS embeddings_387
        , AVG(embeddings_388) AS embeddings_388
        , AVG(embeddings_389) AS embeddings_389
        , AVG(embeddings_390) AS embeddings_390
        , AVG(embeddings_391) AS embeddings_391
        , AVG(embeddings_392) AS embeddings_392
        , AVG(embeddings_393) AS embeddings_393
        , AVG(embeddings_394) AS embeddings_394
        , AVG(embeddings_395) AS embeddings_395
        , AVG(embeddings_396) AS embeddings_396
        , AVG(embeddings_397) AS embeddings_397
        , AVG(embeddings_398) AS embeddings_398
        , AVG(embeddings_399) AS embeddings_399
        , AVG(embeddings_400) AS embeddings_400
        , AVG(embeddings_401) AS embeddings_401
        , AVG(embeddings_402) AS embeddings_402
        , AVG(embeddings_403) AS embeddings_403
        , AVG(embeddings_404) AS embeddings_404
        , AVG(embeddings_405) AS embeddings_405
        , AVG(embeddings_406) AS embeddings_406
        , AVG(embeddings_407) AS embeddings_407
        , AVG(embeddings_408) AS embeddings_408
        , AVG(embeddings_409) AS embeddings_409
        , AVG(embeddings_410) AS embeddings_410
        , AVG(embeddings_411) AS embeddings_411
        , AVG(embeddings_412) AS embeddings_412
        , AVG(embeddings_413) AS embeddings_413
        , AVG(embeddings_414) AS embeddings_414
        , AVG(embeddings_415) AS embeddings_415
        , AVG(embeddings_416) AS embeddings_416
        , AVG(embeddings_417) AS embeddings_417
        , AVG(embeddings_418) AS embeddings_418
        , AVG(embeddings_419) AS embeddings_419
        , AVG(embeddings_420) AS embeddings_420
        , AVG(embeddings_421) AS embeddings_421
        , AVG(embeddings_422) AS embeddings_422
        , AVG(embeddings_423) AS embeddings_423
        , AVG(embeddings_424) AS embeddings_424
        , AVG(embeddings_425) AS embeddings_425
        , AVG(embeddings_426) AS embeddings_426
        , AVG(embeddings_427) AS embeddings_427
        , AVG(embeddings_428) AS embeddings_428
        , AVG(embeddings_429) AS embeddings_429
        , AVG(embeddings_430) AS embeddings_430
        , AVG(embeddings_431) AS embeddings_431
        , AVG(embeddings_432) AS embeddings_432
        , AVG(embeddings_433) AS embeddings_433
        , AVG(embeddings_434) AS embeddings_434
        , AVG(embeddings_435) AS embeddings_435
        , AVG(embeddings_436) AS embeddings_436
        , AVG(embeddings_437) AS embeddings_437
        , AVG(embeddings_438) AS embeddings_438
        , AVG(embeddings_439) AS embeddings_439
        , AVG(embeddings_440) AS embeddings_440
        , AVG(embeddings_441) AS embeddings_441
        , AVG(embeddings_442) AS embeddings_442
        , AVG(embeddings_443) AS embeddings_443
        , AVG(embeddings_444) AS embeddings_444
        , AVG(embeddings_445) AS embeddings_445
        , AVG(embeddings_446) AS embeddings_446
        , AVG(embeddings_447) AS embeddings_447
        , AVG(embeddings_448) AS embeddings_448
        , AVG(embeddings_449) AS embeddings_449
        , AVG(embeddings_450) AS embeddings_450
        , AVG(embeddings_451) AS embeddings_451
        , AVG(embeddings_452) AS embeddings_452
        , AVG(embeddings_453) AS embeddings_453
        , AVG(embeddings_454) AS embeddings_454
        , AVG(embeddings_455) AS embeddings_455
        , AVG(embeddings_456) AS embeddings_456
        , AVG(embeddings_457) AS embeddings_457
        , AVG(embeddings_458) AS embeddings_458
        , AVG(embeddings_459) AS embeddings_459
        , AVG(embeddings_460) AS embeddings_460
        , AVG(embeddings_461) AS embeddings_461
        , AVG(embeddings_462) AS embeddings_462
        , AVG(embeddings_463) AS embeddings_463
        , AVG(embeddings_464) AS embeddings_464
        , AVG(embeddings_465) AS embeddings_465
        , AVG(embeddings_466) AS embeddings_466
        , AVG(embeddings_467) AS embeddings_467
        , AVG(embeddings_468) AS embeddings_468
        , AVG(embeddings_469) AS embeddings_469
        , AVG(embeddings_470) AS embeddings_470
        , AVG(embeddings_471) AS embeddings_471
        , AVG(embeddings_472) AS embeddings_472
        , AVG(embeddings_473) AS embeddings_473
        , AVG(embeddings_474) AS embeddings_474
        , AVG(embeddings_475) AS embeddings_475
        , AVG(embeddings_476) AS embeddings_476
        , AVG(embeddings_477) AS embeddings_477
        , AVG(embeddings_478) AS embeddings_478
        , AVG(embeddings_479) AS embeddings_479
        , AVG(embeddings_480) AS embeddings_480
        , AVG(embeddings_481) AS embeddings_481
        , AVG(embeddings_482) AS embeddings_482
        , AVG(embeddings_483) AS embeddings_483
        , AVG(embeddings_484) AS embeddings_484
        , AVG(embeddings_485) AS embeddings_485
        , AVG(embeddings_486) AS embeddings_486
        , AVG(embeddings_487) AS embeddings_487
        , AVG(embeddings_488) AS embeddings_488
        , AVG(embeddings_489) AS embeddings_489
        , AVG(embeddings_490) AS embeddings_490
        , AVG(embeddings_491) AS embeddings_491
        , AVG(embeddings_492) AS embeddings_492
        , AVG(embeddings_493) AS embeddings_493
        , AVG(embeddings_494) AS embeddings_494
        , AVG(embeddings_495) AS embeddings_495
        , AVG(embeddings_496) AS embeddings_496
        , AVG(embeddings_497) AS embeddings_497
        , AVG(embeddings_498) AS embeddings_498
        , AVG(embeddings_499) AS embeddings_499
        , AVG(embeddings_500) AS embeddings_500
        , AVG(embeddings_501) AS embeddings_501
        , AVG(embeddings_502) AS embeddings_502
        , AVG(embeddings_503) AS embeddings_503
        , AVG(embeddings_504) AS embeddings_504
        , AVG(embeddings_505) AS embeddings_505
        , AVG(embeddings_506) AS embeddings_506
        , AVG(embeddings_507) AS embeddings_507
        , AVG(embeddings_508) AS embeddings_508
        , AVG(embeddings_509) AS embeddings_509
        , AVG(embeddings_510) AS embeddings_510
        , AVG(embeddings_511) AS embeddings_511

    FROM `reddit-employee-datasets.david_bermejo.subclu_v0040_embeddings_comments` AS cem
    INNER JOIN selected_subreddits AS ss
        ON cem.subreddit_id = ss.subreddit_id

    -- LEFT JOIN weights_for_mean AS w
    --     ON cem.comment_id = w.comment_id

    GROUP BY 1, 2
    ORDER BY 1, 2
); -- close CREATE TABLE statment
